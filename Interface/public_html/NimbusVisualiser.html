<!DOCTYPE html>

 <meta charset="UTF-8"> 
 
<html>
	<head>
		<title>Nimbus Network Visualiser</title>
	</head>
	
	<meta name="viewport" content="width=device-width, initial-scale=1">
	
	<link rel="stylesheet" href="http://www.w3schools.com/lib/w3.css">
	<link rel="stylesheet" href="//code.jquery.com/ui/1.12.0/themes/base/jquery-ui.css">
	<link rel="stylesheet" href="/resources/demos/style.css">
	<link rel="stylesheet" href="/styles/style.css">
	<link rel="shortcut icon" href="Images/logo.ico"/>
	
	<script src="visualizer.js"></script>
	<script src="FileSaver.js"></script>
	<script type="text/javascript" src="http://visjs.org/dist/vis.js"></script>
	<script src="https://code.jquery.com/jquery-1.12.4.js"></script>
	<script src="https://code.jquery.com/ui/1.12.0/jquery-ui.js"></script>
    
	<style>
		#draggable { width: 150px; background-color: white; border-radius: 5px; box-shadow: 0px 0px 20px #888888; display: inline-block;}
		#draggableTwo { width: 150px; background-color: white; border-radius: 5px; box-shadow: 0px 0px 20px #888888; display: inline-block;}
	
		.loader {
	 width: 100px;
    height: 100px;


    position: absolute;
    top:0;
    bottom: 0;
    left: 0;
    right: 0;

    margin: auto;
			  border: 16px solid #f3f3f3; /* Light grey */
    border-top: 16px solid #3498db; /* Blue */
    border-radius: 50%;
    width: 120px;
    height: 120px;
    animation: spin 2s linear infinite;
			}

			@-webkit-keyframes spin {
			  0% { -webkit-transform: rotate(0deg); }
			  100% { -webkit-transform: rotate(360deg); }
			}

			@keyframes spin {
			  0% { transform: rotate(0deg); }
			  100% { transform: rotate(360deg); }
			}
	</style>
	
	<script>
		$(function () 
		{
			$("#draggable").draggable();
		});
		$(function () 
		{
			$("#draggableTwo").draggable();
		});
	</script>
	
	<body onload="draw();" style="background-image: url('Images/cloud.jpg'); background-repeat: no-repeat; background-attachment: fixed;background-size: 100%;">
		
		<nav class="w3-sidenav w3-white w3-card-2" style="display:none" id="mySidenav">
			<a href="javascript:void(0)" onclick="w3_close()" class="w3-closenav w3-large">Close &times;</a>
			<p>Info goes here</p>
		</nav>
		
		<div id="topBar" style="background-color: #146eb4; width: 100%;">
			<font id="a_label"color="white">Access Key:</font> <input type="password" id="accessKey" name="access">
			<font  id="s_label"color="white">Secret Key:</font> <input type="password" id="secretKey"name="secret">
			
			<button id="Login" onclick='login()' class="w3-btn" style="background-color: #146eb4;">Login</button>
			<button id="Logout" onclick='logout()' class="w3-btn" style="background-color: #146eb4; display: none;">Logout</button>
			
			<input id='loadFile' type='file' accept='text/plain' style="background-color: #146eb4;" class="w3-btn" onchange='openFile(event)'>
			<button id="saveFile" onclick="writeOutFile()" class="w3-btn" style="background-color: #146eb4;">Save current scan</button>
		</div>
		<div id = "loadicon" style="display:none"class="loader"></div>
		<div id="main">
			<div id = "hierarchyVisualizerDiv"style="position: absolute; height: 90%; width: 100%;"></div>	
			<div id = "securityGroupDiv"style="position: absolute; left:25%; top:25%; height: 50%; width: 50%; visibility: hidden;border-style: solid;">
				
			</div>	
			<img id="closeSecurityImg"  onclick="sec()" src="Images\Exit.png" alt="Exit" style="position: absolute; left:72.5%; top:25%; height: 5%; width: 2.5%; visibility: hidden;">
		</div>

		<script>
			

			var accessKey;
			var secretKey;
			
			function sec()
			{
				document.getElementById("securityGroupDiv").style.visibility='hidden';
				document.getElementById("hierarchyVisualizerDiv").style.visibility='visible';
				document.getElementById("closeSecurityImg").style.visibility='hidden';
				
			}
			function login()
			{
				document.getElementById("Logout").style.display = "inline";
				document.getElementById("Login").style.display = "none";
				accessKey=document.getElementById("accessKey").value;
				secretKey=document.getElementById("secretKey").value;
				document.getElementById("accessKey").style.display = "none";
				document.getElementById("secretKey").style.display = "none";
				document.getElementById("a_label").style.display = "none";
				document.getElementById("s_label").style.display = "none";
				document.getElementById("loadicon").style.display = "inline";
				var xhttp = new XMLHttpRequest();
	
	
				xhttp.onreadystatechange = function() 
				{
	
					if (this.readyState == 4 && this.status == 200) 
					{
						document.getElementById("loadicon").style.display = "none";
						if(!this.responseText.startsWith("Success"))
						{
							logout();
						}
						alert(this.responseText);
					}
				}


				xhttp.open("POST", "http://localhost:8080/NotLikeThisRESTServer_war_exploded/services/validate?a_key="+accessKey+"&s_key="+secretKey, true);
				xhttp.send();
			}
			
			function logout()
			{
				document.getElementById("Logout").style.display = "none";
				document.getElementById("Login").style.display = "inline";
				document.getElementById("accessKey").style.display = "inline";
				document.getElementById("secretKey").style.display = "inline";
					document.getElementById("a_label").style.display = "inline";
				document.getElementById("s_label").style.display = "inline";
			}

			function writeOutFile()
			{
			
				var bufferContents = getBufferContents();
				//alert(bufferContents);
				var str = "{\"NodesArray\":[";
						
				var obj;
				var jsonString;
				
				for(var i = 0; i < bufferContents.length - 1; i++)
				{
					obj = new Object();
					
					obj.Name = bufferContents[i].Name;
					obj.UUID  =  bufferContents[i].UUID;
					obj.Level =  bufferContents[i].Level;
					obj.Relationships =  bufferContents[i].Relationships;
					
					jsonString= JSON.stringify(obj);
					str = str + jsonString + ",";
				}
				
				obj = new Object();
					
				obj.Name = bufferContents[bufferContents.length - 1].Name;
				obj.UUID  =  bufferContents[bufferContents.length - 1].UUID;
				obj.Level =  bufferContents[bufferContents.length - 1].Level;
				obj.Relationships =  bufferContents[bufferContents.length - 1].Relationships;
				obj.SecurityGroups =  bufferContents[bufferContents.length - 1].SecurityGroups;
				obj.Networkinterfaces =  bufferContents[bufferContents.length - 1].Networkinterfaces;
					
				jsonString= JSON.stringify(obj);
				str = str + jsonString + "]}";
					
				var timestamp = new Date().getTime();
				timestamp = timestamp + ".json";
				
				var file = new File([str], timestamp, {type: "text/plain;charset=utf-8"});
				saveAs(file);
			}

			function w3_open() 
			{
				document.getElementById("main").style.marginLeft = "25%";
				document.getElementById("mySidenav").style.width = "25%";
				document.getElementById("mySidenav").style.display = "block";
				document.getElementById("openNav").style.display = 'none';
			}
			
			function w3_close() 
			{
				document.getElementById("main").style.marginLeft = "0%";
				document.getElementById("mySidenav").style.display = "none";
				document.getElementById("openNav").style.display = "inline-block";
			}

			function mouseover(obj)
			{
				obj.style.boxShadow = "0px 0px 10px #555555";
				obj.style.zIndex = "1";
			}

			function mouseleave(obj)
			{
				obj.style.boxShadow = "0px 0px 0px white";
				obj.style.zIndex = "0";
			}
			
			var stage = 0;

			function cycle()
			{
				if(stage == 0)
				{
					scanNetwork();
					document.getElementById("scanNetworkButton").innerHTML = "Pause Scan";
					stage = 1;
				}
				else if(stage == 1)
				{
					paused=true;
					document.getElementById("scanNetworkButton").innerHTML = "Resume Scan";
					
					var xhttp = new XMLHttpRequest();
				
					xhttp.open("GET", "http://localhost:8080/NotLikeThisRESTServer_war_exploded/services/pauseScan", true);
					xhttp.send();
					stage = 2;
					
				}
				else if(stage == 2)
				{
					paused=false;
					document.getElementById("scanNetworkButton").innerHTML = "Pause Scan";
		
					
					var xhttp = new XMLHttpRequest();
				
					xhttp.open("GET", "http://localhost:8080/NotLikeThisRESTServer_war_exploded/services/resumeScan", true);
					xhttp.send();
					setTimeout(function () 
					{
					document.getElementById("loadicon").style.display = "none";
					getNodeFromServer();
				
					}, 3000);
					stage = 1;
	
					
				}
			}
			
			function stopScan()
			{
				stage = 0;
				finished=true;
				document.getElementById("scanNetworkButton").innerHTML = "Scan Network";
				var xhttp = new XMLHttpRequest();
				
				xhttp.open("GET", "http://localhost:8080/NotLikeThisRESTServer_war_exploded/services/stopScan", true);
				xhttp.send();
			}
			
			function textBox()
			{
				document.getElementById("scanFromInput").style.display = "block";
			}

			function scanNetwork() 
			{	
				finished=false;
				clearNodesAndEdges();
				var xhttp = new XMLHttpRequest();
				
				xhttp.open("GET", "http://localhost:8080/NotLikeThisRESTServer_war_exploded/services/startScanner", true);
				xhttp.send();
				document.getElementById("loadicon").style.display = "inline";
				setTimeout(function () 
				{
					document.getElementById("loadicon").style.display = "none";
					getNodeFromServer();
					//startTimer();
				}, 10000);

			}
			function scanFrom()
			{	
				document.getElementById("scanNetworkButton").innerHTML = "Pause Scan";
				stage = 1;
				finished=false;
				clearNodesAndEdges();
				var uuid = document.getElementById("fromUUID").value;
				var level;
				if(uuid.startsWith("vpc"))
				{
					level="Vpc";
				}
				else if(uuid.startsWith("subnet"))
				{
					level="Subnet";
				}
				else if(uuid.startsWith("i"))
				{
					level="Instance";
				}
				else if(uuid.startsWith("-",2))
				{
					level="Region";
				}
				else
				{
					level="Unknown";
				}
				var xhttp = new XMLHttpRequest();
				xhttp.open("GET", "http://localhost:8080/NotLikeThisRESTServer_war_exploded/services/scanFrom?uuid="+uuid+"&level="+level, true);
				xhttp.send();
				document.getElementById("loadicon").style.display = "inline";
				setTimeout(function () 
				{
					document.getElementById("loadicon").style.display = "none";
					getNodeFromServer();
					//startTimer();
				}, 10000);
				
			}
			function scanAllInstances()
			{
				finished=false;
				clearNodesAndEdges();
				var xhttp = new XMLHttpRequest();
				
				xhttp.open("GET", "http://localhost:8080/NotLikeThisRESTServer_war_exploded/services/scanAllInstances", true);
				xhttp.send();
				document.getElementById("loadicon").style.display = "inline";
				setTimeout(function () 
				{
					document.getElementById("loadicon").style.display = "none";
					getNodeFromServer();
					//startTimer();
				}, 10000);
			}
			function scanRegion(region) 
			{	
				document.getElementById("scanNetworkButton").innerHTML = "Pause Scan";
				stage = 1;
				finished=false;
				clearNodesAndEdges();
				var xhttp = new XMLHttpRequest();
				
				xhttp.open("GET", "http://localhost:8080/NotLikeThisRESTServer_war_exploded/services/regionScan?uuid="+region, true);
				xhttp.send();
				document.getElementById("loadicon").style.display = "inline";
				setTimeout(function () 
				{
					document.getElementById("loadicon").style.display = "none";
					getNodeFromServer();
					
				}, 10000);

			}
			
		</script>


		<div id="draggable" class="ui-widget-content" style="border: 1px solid grey; border-radius: 5px;">
				<div id="toolbar" style="height: 20px; background-color: #146eb4; border-top-right-radius: 5px; border-top-left-radius: 5px; cursor: pointer;"></div>
				
				<button id="scanNetworkButton" class="w3-btn" onclick="cycle();" style="width:100%; background-color: orange; position:relative;" onmouseover="mouseover(this)" onmouseleave="mouseleave(this)">Scan Network</button>
				<button id="stopScanButton" onclick="stopScan()"class="w3-btn" style="width:100%; background-color: orange; position:relative;" onmouseover="mouseover(this)" onmouseleave="mouseleave(this)">Stop Scan</button>
				<button id="scanUpButton" class="w3-btn" style="width:100%; background-color: orange; position:relative;" onmouseover="mouseover(this)" onmouseleave="mouseleave(this)">Scan Up</button>
				<button id="scanInstanceButton" onclick="scanAllInstances();" class="w3-btn" style="width:100%; background-color: orange; position:relative;" onmouseover="mouseover(this)" onmouseleave="mouseleave(this)">Scan Instances</button>
				
				<button id="scanFromButton" class="w3-btn" onclick="textBox()" style="width:100%; background-color: orange;">Scan From</button>
				<div id="scanFromInput" style="display: none; width: 100%; background-color: orange;"><input id="fromUUID" type="text" name="access" style="width: 70%;"><button style="width:30%;" onclick="scanFrom()">Go</button></div>

			<div class="w3-dropdown-hover" style="width:100%;">
				<button class="w3-btn" style="width:100%; background-color: orange;">Region</button>
					<div class="w3-dropdown-content w3-border">
						<a href="#" onclick='scanRegion("us-east-1")'>US East (N. Virginia)</a>
						<a href="#" onclick='scanRegion("us-west-1")'>US West (N. California)</a>
						<a href="#" onclick='scanRegion("us-west-2")'>US West (Oregon)</a>
						<a href="#" onclick='scanRegion("ap-northeast-2")'>Asia Pacific (Seoul)</a>
						<a href="#" onclick='scanRegion("ap-southeast-1")'>Asia Pacific (Singapore)</a>
						<a href="#" onclick='scanRegion("ap-southeast-2")'>Asia Pacific (Sydney)</a>
						<a href="#" onclick='scanRegion("ap-northeast-1")'>Asia Pacific (Tokyo)</a>
						<a href="#" onclick='scanRegion("ap-south-1")'>Asia Pacific (Mumbai)</a>
						<a href="#" onclick='scanRegion("eu-central-1")'>EU (Frankfurt)</a>
						<a href="#" onclick='scanRegion("eu-west-1")'>EU (Ireland)</a>
						<a href="#" onclick='scanRegion("sa-east-1")'>South America (São Paulo)</a>
					</div>
			</div>
		</div>
		
		<div id="draggableTwo" class="ui-widget-content" style="border: 1px solid grey; border-radius: 5px;z">
			<div style="border: 1px solid grey; height: 20px; border-top-right-radius: 5px; border-top-left-radius: 5px; background-color: darkgray; cursor: pointer;"></div>
			<textarea  spellcheck="false" style=" float: left; height: 180px; border-bottom-right-radius: 5px; border-bottom-left-radius: 5px; background-color: white; " id="information"></textarea>
		</div>
		
	
	</body>
</html>
